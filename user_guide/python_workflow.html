

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Python workflow tutorial &mdash; KQCircuits  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../_static/logo.svg"/>
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Macro development" href="macro_workflow.html" />
    <link rel="prev" title="Point-and-click workflow tutorial" href="gui_workflow.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: white" >
          

          
            <a href="../index.html">
          

          
            
            <img src="../_static/logo-small.png" class="logo" alt="Logo"/>
          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../installation.html#klayout">KLayout</a></li>
<li class="toctree-l2"><a class="reference internal" href="../installation.html#known-installation-issues">Known installation issues</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../installation.html#installing-different-python-package-versions-to-klayout-manually">Installing different Python package versions to KLayout manually</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">User Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="usage.html">Usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="gui_features.html">GUI Features</a><ul>
<li class="toctree-l3"><a class="reference internal" href="gui_features.html#useful-hotkeys">Useful hotkeys</a></li>
<li class="toctree-l3"><a class="reference internal" href="gui_features.html#introduction-to-elements">Introduction to Elements</a></li>
<li class="toctree-l3"><a class="reference internal" href="gui_features.html#placing-elements">Placing Elements</a></li>
<li class="toctree-l3"><a class="reference internal" href="gui_features.html#modifying-element-parameters">Modifying Element parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="gui_features.html#modifying-waveguides">Modifying waveguides</a></li>
<li class="toctree-l3"><a class="reference internal" href="gui_features.html#editing-waveguidecomposite-nodes">Editing WaveguideComposite Nodes</a></li>
<li class="toctree-l3"><a class="reference internal" href="gui_features.html#converting-elements-placed-in-gui-into-code">Converting elements placed in GUI into code</a></li>
<li class="toctree-l3"><a class="reference internal" href="gui_features.html#useful-menu-commands">Useful Menu Commands</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="gui_workflow.html">Point-and-click workflow tutorial</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Python workflow tutorial</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#file-system-hierarchy">File system hierarchy</a></li>
<li class="toctree-l3"><a class="reference internal" href="#structure-of-pcell-code">Structure of  PCell code</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#element-class"><code class="xref py py-class docutils literal notranslate"><span class="pre">Element</span></code> class</a></li>
<li class="toctree-l4"><a class="reference internal" href="#pcell-libraries">PCell Libraries</a></li>
<li class="toctree-l4"><a class="reference internal" href="#parameters">Parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="#build">Build</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#example-of-defining-an-element-class">Example of defining an <code class="xref py py-class docutils literal notranslate"><span class="pre">Element</span></code> class</a></li>
<li class="toctree-l3"><a class="reference internal" href="#example-of-defining-a-chip-and-inserting-elements-into-it">Example of defining a Chip and inserting elements into it</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#defining-sampleholder-types">Defining sampleholder types</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#refpoints">Refpoints</a></li>
<li class="toctree-l3"><a class="reference internal" href="#faces">Faces</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#layer-configuration-files">Layer configuration files</a></li>
<li class="toctree-l4"><a class="reference internal" href="#adding-a-new-face">Adding a new face</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#kqcircuit-s-layers">KQCircuit’s Layers</a></li>
<li class="toctree-l3"><a class="reference internal" href="#opening-element-or-chip-from-an-ide">Opening <code class="xref py py-class docutils literal notranslate"><span class="pre">Element</span></code> or <code class="xref py py-class docutils literal notranslate"><span class="pre">Chip</span></code> from an IDE</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="macro_workflow.html">Macro development</a><ul>
<li class="toctree-l3"><a class="reference internal" href="macro_workflow.html#basic-workflow">Basic workflow</a></li>
<li class="toctree-l3"><a class="reference internal" href="macro_workflow.html#debugger">Debugger</a></li>
<li class="toctree-l3"><a class="reference internal" href="macro_workflow.html#reloading-libraries">Reloading libraries</a></li>
<li class="toctree-l3"><a class="reference internal" href="macro_workflow.html#examples">Examples</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="mask_export.html">Mask export</a><ul>
<li class="toctree-l3"><a class="reference internal" href="mask_export.html#tutorial">Tutorial</a><ul>
<li class="toctree-l4"><a class="reference internal" href="mask_export.html#basic-mask-script-and-export">Basic mask script and export</a></li>
<li class="toctree-l4"><a class="reference internal" href="mask_export.html#ground-grid">Ground grid</a></li>
<li class="toctree-l4"><a class="reference internal" href="mask_export.html#adding-and-modifying-chips">Adding and modifying chips</a></li>
<li class="toctree-l4"><a class="reference internal" href="mask_export.html#multi-face-masks">Multi-face masks</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="simulations.html">External simulation tools</a><ul>
<li class="toctree-l3"><a class="reference internal" href="simulation/simulation_object.html">Creating simulation object</a><ul>
<li class="toctree-l4"><a class="reference internal" href="simulation/simulation_object.html#geometry-from-klayout-gui">Geometry from Klayout GUI</a></li>
<li class="toctree-l4"><a class="reference internal" href="simulation/simulation_object.html#geometry-from-kqcircuits-library">Geometry from KQCircuits library</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="simulation/ansys_export.html">Ansys export</a><ul>
<li class="toctree-l4"><a class="reference internal" href="simulation/ansys_export.html#ansys-scripts">Ansys scripts</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="simulation/sonnet_export.html">Sonnet export</a></li>
<li class="toctree-l3"><a class="reference internal" href="simulation/gmsh_elmer_export.html">Gmsh/Elmer export</a></li>
<li class="toctree-l3"><a class="reference internal" href="simulation/export_and_run.html">Run and export in one line</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="xsection.html">Creating cross section images</a><ul>
<li class="toctree-l3"><a class="reference internal" href="xsection.html#klayout-gui-xsection-tool">KLayout GUI XSection tool</a></li>
<li class="toctree-l3"><a class="reference internal" href="xsection.html#xsection-call-in-kqc-code">XSection call in KQC code</a></li>
<li class="toctree-l3"><a class="reference internal" href="xsection.html#process-files-xs">Process files (.xs)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="terminology.html">Terminology</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../salt.html">Salt Package Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../salt.html#installing-kqcircuits-salt-package">Installing KQCircuits Salt Package</a></li>
<li class="toctree-l2"><a class="reference internal" href="../salt.html#user-specific-content">User Specific Content</a></li>
<li class="toctree-l2"><a class="reference internal" href="../salt.html#upgrading-or-removing-salt-package">Upgrading or Removing Salt Package</a></li>
<li class="toctree-l2"><a class="reference internal" href="../salt.html#release-notes">Release Notes</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../developer/index.html">Developer Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../developer/setup.html">Developer Setup</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../developer/setup.html#prerequisites">Prerequisites</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../developer/setup.html#python">Python</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../developer/setup.html#sources">Sources</a></li>
<li class="toctree-l3"><a class="reference internal" href="../developer/setup.html#install">Install</a></li>
<li class="toctree-l3"><a class="reference internal" href="../developer/setup.html#update">Update</a></li>
<li class="toctree-l3"><a class="reference internal" href="../developer/setup.html#secondary-install">Secondary install</a></li>
<li class="toctree-l3"><a class="reference internal" href="../developer/setup.html#manual-installation">Manual installation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../developer/setup.html#linux-or-macos">Linux or MacOS</a></li>
<li class="toctree-l4"><a class="reference internal" href="../developer/setup.html#windows">Windows</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../developer/standalone.html">KLayout Standalone Usage</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../developer/standalone.html#prerequisites">Prerequisites</a></li>
<li class="toctree-l3"><a class="reference internal" href="../developer/standalone.html#installation">Installation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../developer/standalone.html#usage">Usage</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../developer/containers.html">Containers</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../developer/containers.html#cli-usage">CLI usage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../developer/containers.html#docker-ci-usage">Docker CI usage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../developer/containers.html#singularity-usage">Singularity usage</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../developer/architecture.html">Architecture</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../developer/architecture.html#elements">Elements</a></li>
<li class="toctree-l3"><a class="reference internal" href="../developer/architecture.html#pcell-parameters">PCell parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="../developer/architecture.html#libraries">Libraries</a></li>
<li class="toctree-l3"><a class="reference internal" href="../developer/architecture.html#pya-resolver">pya resolver</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../developer/testing.html">Testing</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../developer/testing.html#unit-tests">Unit tests</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../developer/coding_style.html">Coding Style</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developer/documentation.html">Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../contributing.html">Contributing</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../contributing.html#versioning">Versioning</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../api/kqcircuits.html">API documentation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../api/kqcircuits.chips.html">kqcircuits.chips</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.chips.airbridge_crossings.html">kqcircuits.chips.airbridge_crossings</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.chips.airbridge_dc_test.html">kqcircuits.chips.airbridge_dc_test</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.chips.chip.html">kqcircuits.chips.chip</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.chips.crossing_twoface.html">kqcircuits.chips.crossing_twoface</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.chips.daisy_woven.html">kqcircuits.chips.daisy_woven</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.chips.dc_test.html">kqcircuits.chips.dc_test</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.chips.demo.html">kqcircuits.chips.demo</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.chips.demo_twoface.html">kqcircuits.chips.demo_twoface</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.chips.empty.html">kqcircuits.chips.empty</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.chips.junction_test.html">kqcircuits.chips.junction_test</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.chips.junction_test2.html">kqcircuits.chips.junction_test2</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.chips.launchers.html">kqcircuits.chips.launchers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.chips.lithography_test.html">kqcircuits.chips.lithography_test</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.chips.lithography_test_twoface.html">kqcircuits.chips.lithography_test_twoface</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.chips.quality_factor.html">kqcircuits.chips.quality_factor</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.chips.quality_factor_twoface.html">kqcircuits.chips.quality_factor_twoface</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.chips.sample_holder_test.html">kqcircuits.chips.sample_holder_test</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.chips.shaping.html">kqcircuits.chips.shaping</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.chips.simple.html">kqcircuits.chips.simple</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.chips.single_xmons.html">kqcircuits.chips.single_xmons</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.chips.stripes.html">kqcircuits.chips.stripes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.chips.tsv_test.html">kqcircuits.chips.tsv_test</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.chips.xmons_direct_coupling.html">kqcircuits.chips.xmons_direct_coupling</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.chips.html#module-kqcircuits.chips">Module contents</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../api/kqcircuits.elements.html">kqcircuits.elements</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.elements.airbridges.html">kqcircuits.elements.airbridges</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/kqcircuits.elements.airbridges.airbridge.html">kqcircuits.elements.airbridges.airbridge</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/kqcircuits.elements.airbridges.airbridge_multi_face.html">kqcircuits.elements.airbridges.airbridge_multi_face</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/kqcircuits.elements.airbridges.airbridge_rectangular.html">kqcircuits.elements.airbridges.airbridge_rectangular</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/kqcircuits.elements.airbridges.html#module-kqcircuits.elements.airbridges">Module contents</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.elements.flip_chip_connectors.html">kqcircuits.elements.flip_chip_connectors</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/kqcircuits.elements.flip_chip_connectors.flip_chip_connector.html">kqcircuits.elements.flip_chip_connectors.flip_chip_connector</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/kqcircuits.elements.flip_chip_connectors.flip_chip_connector_dc.html">kqcircuits.elements.flip_chip_connectors.flip_chip_connector_dc</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/kqcircuits.elements.flip_chip_connectors.flip_chip_connector_rf.html">kqcircuits.elements.flip_chip_connectors.flip_chip_connector_rf</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/kqcircuits.elements.flip_chip_connectors.html#module-kqcircuits.elements.flip_chip_connectors">Module contents</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.elements.fluxlines.html">kqcircuits.elements.fluxlines</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/kqcircuits.elements.fluxlines.fluxline.html">kqcircuits.elements.fluxlines.fluxline</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/kqcircuits.elements.fluxlines.fluxline_standard.html">kqcircuits.elements.fluxlines.fluxline_standard</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/kqcircuits.elements.fluxlines.fluxline_straight.html">kqcircuits.elements.fluxlines.fluxline_straight</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/kqcircuits.elements.fluxlines.html#module-kqcircuits.elements.fluxlines">Module contents</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.elements.markers.html">kqcircuits.elements.markers</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/kqcircuits.elements.markers.marker.html">kqcircuits.elements.markers.marker</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/kqcircuits.elements.markers.marker_standard.html">kqcircuits.elements.markers.marker_standard</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/kqcircuits.elements.markers.html#module-kqcircuits.elements.markers">Module contents</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.elements.tsvs.html">kqcircuits.elements.tsvs</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/kqcircuits.elements.tsvs.tsv.html">kqcircuits.elements.tsvs.tsv</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/kqcircuits.elements.tsvs.tsv_ellipse.html">kqcircuits.elements.tsvs.tsv_ellipse</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/kqcircuits.elements.tsvs.tsv_standard.html">kqcircuits.elements.tsvs.tsv_standard</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/kqcircuits.elements.tsvs.html#module-kqcircuits.elements.tsvs">Module contents</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.elements.airbridge_connection.html">kqcircuits.elements.airbridge_connection</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.elements.chip_frame.html">kqcircuits.elements.chip_frame</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.elements.circular_capacitor.html">kqcircuits.elements.circular_capacitor</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.elements.element.html">kqcircuits.elements.element</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.elements.finger_capacitor_square.html">kqcircuits.elements.finger_capacitor_square</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.elements.finger_capacitor_taper.html">kqcircuits.elements.finger_capacitor_taper</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.elements.launcher.html">kqcircuits.elements.launcher</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.elements.launcher_dc.html">kqcircuits.elements.launcher_dc</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.elements.mask_marker_fc.html">kqcircuits.elements.mask_marker_fc</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.elements.meander.html">kqcircuits.elements.meander</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.elements.smooth_capacitor.html">kqcircuits.elements.smooth_capacitor</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.elements.spiral_resonator_polygon.html">kqcircuits.elements.spiral_resonator_polygon</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.elements.waveguide_composite.html">kqcircuits.elements.waveguide_composite</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.elements.waveguide_coplanar.html">kqcircuits.elements.waveguide_coplanar</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.elements.waveguide_coplanar_curved.html">kqcircuits.elements.waveguide_coplanar_curved</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.elements.waveguide_coplanar_splitter.html">kqcircuits.elements.waveguide_coplanar_splitter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.elements.waveguide_coplanar_straight.html">kqcircuits.elements.waveguide_coplanar_straight</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.elements.waveguide_coplanar_taper.html">kqcircuits.elements.waveguide_coplanar_taper</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.elements.html#module-kqcircuits.elements">Module contents</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../api/kqcircuits.junctions.html">kqcircuits.junctions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.junctions.junction.html">kqcircuits.junctions.junction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.junctions.manhattan.html">kqcircuits.junctions.manhattan</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.junctions.manhattan_single_junction.html">kqcircuits.junctions.manhattan_single_junction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.junctions.no_squid.html">kqcircuits.junctions.no_squid</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.junctions.sim.html">kqcircuits.junctions.sim</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.junctions.squid.html">kqcircuits.junctions.squid</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.junctions.html#module-kqcircuits.junctions">Module contents</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../api/kqcircuits.layer_config.html">kqcircuits.layer_config</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.layer_config.default_layer_config.html">kqcircuits.layer_config.default_layer_config</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.layer_config.example_layer_config.html">kqcircuits.layer_config.example_layer_config</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../api/kqcircuits.masks.html">kqcircuits.masks</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.masks.mask_export.html">kqcircuits.masks.mask_export</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.masks.mask_layout.html">kqcircuits.masks.mask_layout</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.masks.mask_set.html">kqcircuits.masks.mask_set</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.masks.html#module-kqcircuits.masks">Module contents</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../api/kqcircuits.qubits.html">kqcircuits.qubits</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.qubits.double_pads.html">kqcircuits.qubits.double_pads</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.qubits.double_pads_splines.html">kqcircuits.qubits.double_pads_splines</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.qubits.qubit.html">kqcircuits.qubits.qubit</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.qubits.swissmon.html">kqcircuits.qubits.swissmon</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.qubits.html#module-kqcircuits.qubits">Module contents</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../api/kqcircuits.simulations.html">kqcircuits.simulations</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.simulations.export.html">kqcircuits.simulations.export</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/kqcircuits.simulations.export.ansys.html">kqcircuits.simulations.export.ansys</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/kqcircuits.simulations.export.elmer.html">kqcircuits.simulations.export.elmer</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/kqcircuits.simulations.export.sonnet.html">kqcircuits.simulations.export.sonnet</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/kqcircuits.simulations.export.xsection.html">kqcircuits.simulations.export.xsection</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/kqcircuits.simulations.export.export_and_run.html">kqcircuits.simulations.export.export_and_run</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/kqcircuits.simulations.export.simulation_export.html">kqcircuits.simulations.export.simulation_export</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/kqcircuits.simulations.export.util.html">kqcircuits.simulations.export.util</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/kqcircuits.simulations.export.html#module-kqcircuits.simulations.export">Module contents</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.simulations.airbridges_sim.html">kqcircuits.simulations.airbridges_sim</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.simulations.circular_capacitor_sim.html">kqcircuits.simulations.circular_capacitor_sim</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.simulations.cross_section_simulation.html">kqcircuits.simulations.cross_section_simulation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.simulations.double_pads_sim.html">kqcircuits.simulations.double_pads_sim</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.simulations.empty_simulation.html">kqcircuits.simulations.empty_simulation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.simulations.finger_capacitor_sim.html">kqcircuits.simulations.finger_capacitor_sim</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.simulations.flip_chip_connector_sim.html">kqcircuits.simulations.flip_chip_connector_sim</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.simulations.port.html">kqcircuits.simulations.port</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.simulations.simulation.html">kqcircuits.simulations.simulation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.simulations.single_xmon.html">kqcircuits.simulations.single_xmon</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.simulations.single_xmons_full_chip_sim.html">kqcircuits.simulations.single_xmons_full_chip_sim</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.simulations.waveguides_sim.html">kqcircuits.simulations.waveguides_sim</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.simulations.xmons_direct_coupling_full_chip_sim.html">kqcircuits.simulations.xmons_direct_coupling_full_chip_sim</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.simulations.xmons_direct_coupling_sim.html">kqcircuits.simulations.xmons_direct_coupling_sim</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.simulations.html#module-kqcircuits.simulations">Module contents</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../api/kqcircuits.test_structures.html">kqcircuits.test_structures</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.test_structures.junction_test_pads.html">kqcircuits.test_structures.junction_test_pads</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/kqcircuits.test_structures.junction_test_pads.junction_test_pads.html">kqcircuits.test_structures.junction_test_pads.junction_test_pads</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/kqcircuits.test_structures.junction_test_pads.junction_test_pads_simple.html">kqcircuits.test_structures.junction_test_pads.junction_test_pads_simple</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/kqcircuits.test_structures.junction_test_pads.html#module-kqcircuits.test_structures.junction_test_pads">Module contents</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.test_structures.airbridge_dc.html">kqcircuits.test_structures.airbridge_dc</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.test_structures.cross_test.html">kqcircuits.test_structures.cross_test</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.test_structures.stripes_test.html">kqcircuits.test_structures.stripes_test</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.test_structures.test_structure.html">kqcircuits.test_structures.test_structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.test_structures.tsv_test_pattern.html">kqcircuits.test_structures.tsv_test_pattern</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.test_structures.html#module-kqcircuits.test_structures">Module contents</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../api/kqcircuits.util.html">kqcircuits.util</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.util.area.html">kqcircuits.util.area</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.util.count_instances.html">kqcircuits.util.count_instances</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.util.coupler_lib.html">kqcircuits.util.coupler_lib</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.util.deep_delete.html">kqcircuits.util.deep_delete</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.util.dependencies.html">kqcircuits.util.dependencies</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.util.edit_node_plugin.html">kqcircuits.util.edit_node_plugin</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.util.export_helper.html">kqcircuits.util.export_helper</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.util.geometry_helper.html">kqcircuits.util.geometry_helper</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.util.geometry_json_encoder.html">kqcircuits.util.geometry_json_encoder</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.util.groundgrid.html">kqcircuits.util.groundgrid</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.util.gui_helper.html">kqcircuits.util.gui_helper</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.util.import_helper.html">kqcircuits.util.import_helper</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.util.label.html">kqcircuits.util.label</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.util.layout_to_code.html">kqcircuits.util.layout_to_code</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.util.library_helper.html">kqcircuits.util.library_helper</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.util.log_router.html">kqcircuits.util.log_router</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.util.macro_prepare.html">kqcircuits.util.macro_prepare</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.util.merge.html">kqcircuits.util.merge</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.util.netlist_extraction.html">kqcircuits.util.netlist_extraction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.util.netlist_graph.html">kqcircuits.util.netlist_graph</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.util.parameter_helper.html">kqcircuits.util.parameter_helper</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.util.parameters.html">kqcircuits.util.parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.util.plugin_startup.html">kqcircuits.util.plugin_startup</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.util.refpoints.html">kqcircuits.util.refpoints</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.util.replace_squids.html">kqcircuits.util.replace_squids</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.util.symmetric_polygons.html">kqcircuits.util.symmetric_polygons</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/kqcircuits.util.html#module-kqcircuits.util">Module contents</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../api/kqcircuits.defaults.html">kqcircuits.defaults</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/kqcircuits.klayout_view.html">kqcircuits.klayout_view</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/kqcircuits.layer_cluster.html">kqcircuits.layer_cluster</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/kqcircuits.pya_resolver.html">kqcircuits.pya_resolver</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/kqcircuits.html#module-kqcircuits">Module contents</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../support.html">Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../citing.html">Citing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../trademarks.html">Trademarks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../about.html">About</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">KQCircuits</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">User Guide</a> &raquo;</li>
        
      <li>Python workflow tutorial</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            
              <a href="https://github.com/iqm-finland/KQCircuits/blob/main/docs/user_guide/python_workflow.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="python-workflow-tutorial">
<h1>Python workflow tutorial<a class="headerlink" href="#python-workflow-tutorial" title="Permalink to this headline">¶</a></h1>
<p>This is a collection of tips and tricks about the “Python workflow”.</p>
<p>To unlock the full potential of KQCircuits the user often needs to define new Chips and Elements,
which is done by writing Python code. This can be done in the Macro Editor included in KLayout, or
using any external code editor. To start working with the KQCircuits code base directly, see
<a class="reference internal" href="../developer/setup.html#developer-setup"><span class="std std-ref">Developer Setup</span></a>. In addition to KQCircuits documentation it is useful
to check the <a class="reference external" href="https://www.klayout.de/doc.html">KLayout documentation</a> when
writing Python code for new elements.</p>
<div class="section" id="file-system-hierarchy">
<h2>File system hierarchy<a class="headerlink" href="#file-system-hierarchy" title="Permalink to this headline">¶</a></h2>
<p>In the KQCircuits root folder the most important folder for most users is the
<a class="reference external" href="https://github.com/iqm-finland/KQCircuits/blob/main/klayout_package">klayout_package</a> folder, which is also all that is included in the Salt
package. Other folders are mainly for automatic tests and documentation.
KQCircuits code is divided into the <a class="reference external" href="https://github.com/iqm-finland/KQCircuits/blob/main/klayout_package/python/kqcircuits">kqcircuits</a> and
<a class="reference external" href="https://github.com/iqm-finland/KQCircuits/blob/main/klayout_package/python/scripts">scripts</a> folders in <a class="reference external" href="https://github.com/iqm-finland/KQCircuits/blob/main/klayout_package/python">klayout_package/python</a>.
These two folders are also (after installation process) linked as symbolic links <code class="docutils literal notranslate"><span class="pre">kqcircuits</span></code> and
<code class="docutils literal notranslate"><span class="pre">kqcircuits_scripts</span></code> in the <code class="docutils literal notranslate"><span class="pre">~/.klayout</span></code> or <code class="docutils literal notranslate"><span class="pre">~/KLayout</span></code> folder.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">kqcircuits</span></code> folder contains all the KQCircuits PCell classes and many
other modules used by them or by scripts. Folders directly under under
<code class="docutils literal notranslate"><span class="pre">kqcircuits</span></code> containing PCell classes correspond to different PCell
libraries such as elements, chips, or test structures.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">scripts</span></code> folder contains macros to be run in KLayout GUI and
scripts for generating simulation files or mask files. The files there are in
general not meant to be imported in other Python files. The outputs of
simulation or mask scripts can be found in the <code class="docutils literal notranslate"><span class="pre">tmp</span></code> folder below the main
KQCircuits folder.</p>
</div>
<div class="section" id="structure-of-pcell-code">
<h2>Structure of  PCell code<a class="headerlink" href="#structure-of-pcell-code" title="Permalink to this headline">¶</a></h2>
<div class="section" id="element-class">
<h3><a class="reference internal" href="../api/kqcircuits.elements.element.html#kqcircuits.elements.element.Element" title="kqcircuits.elements.element.Element"><code class="xref py py-class docutils literal notranslate"><span class="pre">Element</span></code></a> class<a class="headerlink" href="#element-class" title="Permalink to this headline">¶</a></h3>
<p>Any KQCircuits PCells must be derived from the <a class="reference internal" href="../api/kqcircuits.elements.element.html#kqcircuits.elements.element.Element" title="kqcircuits.elements.element.Element"><code class="xref py py-class docutils literal notranslate"><span class="pre">Element</span></code></a> class, and we
call them “elements”. For example, to define a new element <code class="docutils literal notranslate"><span class="pre">MyElement</span></code> you
would start the code with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyElement</span><span class="p">(</span><span class="n">Element</span><span class="p">):</span>
</pre></div>
</div>
<p>You can of course also have elements derived from other existing elements
instead of Element directly:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyElement2</span><span class="p">(</span><span class="n">MyElement</span><span class="p">):</span>
</pre></div>
</div>
<p>The KQCircuits Element class offers many useful features compared to normal
KLayout PCells. These features include helper functions for inserting subcells
and for using layers, a refpoint system for positioning elements, nicer
parameter syntax, automatic loading into a pcell library, and more.
Further details about the code architecture of KQCircuits elements can be
found in <a class="reference internal" href="../developer/architecture.html#architecture-elements"><span class="std std-ref">Elements</span></a>.</p>
</div>
<div class="section" id="pcell-libraries">
<h3>PCell Libraries<a class="headerlink" href="#pcell-libraries" title="Permalink to this headline">¶</a></h3>
<p>There are separate PCell libraries in KQCircuits for certain kinds of
elements, such as qubits or chips. To add your element into a specific
library, it must be put in the corresponding subfolder (or its subfolders) in
<code class="docutils literal notranslate"><span class="pre">kqcircuits</span></code> folder and it must be a child class of the corresponding base
class. For example, to define a new qubit in the “Qubit library”, you would
need to have:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyQubit</span><span class="p">(</span><span class="n">Qubit</span><span class="p">):</span>
</pre></div>
</div>
<p>in a file <code class="docutils literal notranslate"><span class="pre">my_qubit.py</span></code> in <code class="docutils literal notranslate"><span class="pre">kqcircuits/qubits</span></code> folder. The registration
of PCell classes to different libraries is handled by KQCircuits code in
<a class="reference external" href="https://github.com/iqm-finland/KQCircuits/blob/main/klayout_package/python/kqcircuits/util/library_helper.py">library_helper.py</a> and <a class="reference external" href="https://github.com/iqm-finland/KQCircuits/blob/main/klayout_package/python/kqcircuits/elements/element.py">element.py</a>. For more information about PCell libraries see the KLayout
documentation pages
<a class="reference external" href="https://www.klayout.de/doc-qt5/about/about_libraries.html">https://www.klayout.de/doc-qt5/about/about_libraries.html</a>,
<a class="reference external" href="https://www.klayout.de/doc-qt5/code/class_Library.html">https://www.klayout.de/doc-qt5/code/class_Library.html</a>, and
<a class="reference external" href="https://www.klayout.de/doc-qt5/programming/ruby_pcells.html#h2-426">https://www.klayout.de/doc-qt5/programming/ruby_pcells.html#h2-426</a> (in Ruby).</p>
</div>
<div class="section" id="parameters">
<h3>Parameters<a class="headerlink" href="#parameters" title="Permalink to this headline">¶</a></h3>
<p>PCell parameters are used to create PCell instances with different parameter
values. They can be modified in GUI or when creating the instance in code.
The PCell parameters of a KQCircuits element are defined using <code class="docutils literal notranslate"><span class="pre">Param</span></code>
objects as class-level variables, for example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">bridge_length</span> <span class="o">=</span> <span class="n">Param</span><span class="p">(</span><span class="n">pdt</span><span class="o">.</span><span class="n">TypeDouble</span><span class="p">,</span> <span class="s2">&quot;Bridge length (from pad to pad)&quot;</span><span class="p">,</span> <span class="mi">44</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;μm&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">Param</span></code>  definition always has type, description and default value, and
optionally some other information such as the unit or <code class="docutils literal notranslate"><span class="pre">hidden=True</span></code> to hide
it from GUI. More information about parameters can be found in
<a class="reference internal" href="../developer/architecture.html#architecture-parameters"><span class="std std-ref">PCell parameters</span></a> section.</p>
</div>
<div class="section" id="build">
<h3>Build<a class="headerlink" href="#build" title="Permalink to this headline">¶</a></h3>
<p>The geometry for any KQCircuit element is created in the <code class="docutils literal notranslate"><span class="pre">build</span></code> method, so
generally you should define at least that method in you element classes. See
<a class="reference internal" href="../developer/architecture.html#architecture-elements"><span class="std std-ref">Elements</span></a> section for more details about how this works.</p>
</div>
</div>
<div class="section" id="example-of-defining-an-element-class">
<h2>Example of defining an <a class="reference internal" href="../api/kqcircuits.elements.element.html#kqcircuits.elements.element.Element" title="kqcircuits.elements.element.Element"><code class="xref py py-class docutils literal notranslate"><span class="pre">Element</span></code></a> class<a class="headerlink" href="#example-of-defining-an-element-class" title="Permalink to this headline">¶</a></h2>
<p>Here is an example of defining a new element, with code comments explaining
the different parts:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import any modules, classes or functions used in our code.</span>
<span class="kn">from</span> <span class="nn">kqcircuits.elements.element</span> <span class="kn">import</span> <span class="n">Element</span>
<span class="kn">from</span> <span class="nn">kqcircuits.pya_resolver</span> <span class="kn">import</span> <span class="n">pya</span>
<span class="kn">from</span> <span class="nn">kqcircuits.util.parameters</span> <span class="kn">import</span> <span class="n">Param</span><span class="p">,</span> <span class="n">pdt</span>
<span class="kn">from</span> <span class="nn">kqcircuits.util.symmetric_polygons</span> <span class="kn">import</span> <span class="n">polygon_with_vsym</span>


<span class="c1"># Any KQCircuits element must inherit from Element.</span>
<span class="k">class</span> <span class="nc">SimpleCross</span><span class="p">(</span><span class="n">Element</span><span class="p">):</span>

    <span class="c1"># Define PCell parameters for this class here.</span>
    <span class="c1"># Each parameter definition contains the parameter type, description and default value.</span>
    <span class="c1"># Other optional data such as the unit can also be defined for parameters.</span>
    <span class="n">arm_length</span> <span class="o">=</span> <span class="n">Param</span><span class="p">(</span><span class="n">pdt</span><span class="o">.</span><span class="n">TypeDouble</span><span class="p">,</span> <span class="s2">&quot;Cross arm length&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;μm&quot;</span><span class="p">)</span>

    <span class="c1"># The build() function is where the element geometry is built.</span>
    <span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># We define a hardcoded value for arm_width, so it cannot be changed from outside like arm_length.</span>
        <span class="n">arm_width</span> <span class="o">=</span> <span class="mi">30</span>
        <span class="c1"># Define some variables to hold values used commonly in this function.</span>
        <span class="n">len1</span> <span class="o">=</span> <span class="n">arm_width</span><span class="o">/</span><span class="mi">2</span>
        <span class="n">len2</span> <span class="o">=</span> <span class="n">arm_width</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">arm_length</span>
        <span class="c1"># Define the cross polygon using a list of DPoints.</span>
        <span class="n">cross_poly</span> <span class="o">=</span> <span class="n">pya</span><span class="o">.</span><span class="n">DPolygon</span><span class="p">([</span>
            <span class="n">pya</span><span class="o">.</span><span class="n">DPoint</span><span class="p">(</span><span class="o">-</span><span class="n">len1</span><span class="p">,</span> <span class="o">-</span><span class="n">len2</span><span class="p">),</span>
            <span class="n">pya</span><span class="o">.</span><span class="n">DPoint</span><span class="p">(</span><span class="o">-</span><span class="n">len1</span><span class="p">,</span> <span class="o">-</span><span class="n">len1</span><span class="p">),</span>
            <span class="n">pya</span><span class="o">.</span><span class="n">DPoint</span><span class="p">(</span><span class="o">-</span><span class="n">len2</span><span class="p">,</span> <span class="o">-</span><span class="n">len1</span><span class="p">),</span>
            <span class="n">pya</span><span class="o">.</span><span class="n">DPoint</span><span class="p">(</span><span class="o">-</span><span class="n">len2</span><span class="p">,</span> <span class="n">len1</span><span class="p">),</span>
            <span class="n">pya</span><span class="o">.</span><span class="n">DPoint</span><span class="p">(</span><span class="o">-</span><span class="n">len1</span><span class="p">,</span> <span class="n">len1</span><span class="p">),</span>
            <span class="n">pya</span><span class="o">.</span><span class="n">DPoint</span><span class="p">(</span><span class="o">-</span><span class="n">len1</span><span class="p">,</span> <span class="n">len2</span><span class="p">),</span>
            <span class="n">pya</span><span class="o">.</span><span class="n">DPoint</span><span class="p">(</span><span class="n">len1</span><span class="p">,</span> <span class="n">len2</span><span class="p">),</span>
            <span class="n">pya</span><span class="o">.</span><span class="n">DPoint</span><span class="p">(</span><span class="n">len1</span><span class="p">,</span> <span class="n">len1</span><span class="p">),</span>
            <span class="n">pya</span><span class="o">.</span><span class="n">DPoint</span><span class="p">(</span><span class="n">len2</span><span class="p">,</span> <span class="n">len1</span><span class="p">),</span>
            <span class="n">pya</span><span class="o">.</span><span class="n">DPoint</span><span class="p">(</span><span class="n">len2</span><span class="p">,</span> <span class="o">-</span><span class="n">len1</span><span class="p">),</span>
            <span class="n">pya</span><span class="o">.</span><span class="n">DPoint</span><span class="p">(</span><span class="n">len1</span><span class="p">,</span> <span class="o">-</span><span class="n">len1</span><span class="p">),</span>
            <span class="n">pya</span><span class="o">.</span><span class="n">DPoint</span><span class="p">(</span><span class="n">len1</span><span class="p">,</span> <span class="o">-</span><span class="n">len2</span><span class="p">),</span>
        <span class="p">])</span>
        <span class="c1"># Add the cross polygon to the cell.</span>
        <span class="c1"># We use the get_layer() function to select in which layer the polygon is added.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cell</span><span class="o">.</span><span class="n">shapes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_layer</span><span class="p">(</span><span class="s2">&quot;base_metal_gap_wo_grid&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">cross_poly</span><span class="p">)</span>
</pre></div>
</div>
<p>To include this element in the KQCircuits element library, copy this code to a
new Python-file <code class="docutils literal notranslate"><span class="pre">simple_cross.py</span></code> in the
<code class="docutils literal notranslate"><span class="pre">klayout_package/python/kqcircuits/elements</span></code> folder. Then <code class="docutils literal notranslate"><span class="pre">SimpleCross</span></code>
can be used like any other KQCircuits element.</p>
</div>
<div class="section" id="example-of-defining-a-chip-and-inserting-elements-into-it">
<h2>Example of defining a Chip and inserting elements into it<a class="headerlink" href="#example-of-defining-a-chip-and-inserting-elements-into-it" title="Permalink to this headline">¶</a></h2>
<p>Many elements not only create their own geometry from scratch, but also
include other elements as subcells. This is especially true for chips, which
typically use existing elements as building blocks instead of producing shapes
directly. In this example we show how to place instances of the <code class="docutils literal notranslate"><span class="pre">SimpleCross</span></code>
element created in the previous section into a new chip:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">kqcircuits.chips.chip</span> <span class="kn">import</span> <span class="n">Chip</span>
<span class="kn">from</span> <span class="nn">kqcircuits.elements.simple_cross</span> <span class="kn">import</span> <span class="n">SimpleCross</span>
<span class="kn">from</span> <span class="nn">kqcircuits.pya_resolver</span> <span class="kn">import</span> <span class="n">pya</span>


<span class="c1"># New chip implementation must use the Chip element as a base class.</span>
<span class="c1"># As chips are also elements, all the previous explanations about</span>
<span class="c1"># parameters, build-method etc. hold also for them.</span>
<span class="k">class</span> <span class="nc">NewChip1</span><span class="p">(</span><span class="n">Chip</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="c1"># The produce_launchers function creates launchers fitting a certain</span>
        <span class="c1"># sampleholder and sets the chip size accordingly. The available</span>
        <span class="c1"># sampleholder types are defined in defaults.py (default_sampleholders).</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">produce_launchers</span><span class="p">(</span><span class="s2">&quot;SMA8&quot;</span><span class="p">)</span>

        <span class="c1"># Define variable for half chip width for positioning elements</span>
        <span class="n">half_width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">width</span><span class="p">()</span><span class="o">/</span><span class="mi">2</span>

        <span class="c1"># Elements can be inserted to other elements (including chips) using the insert_cell function.</span>
        <span class="c1"># Giving the class name, instance transformation and pcell parameters, it creates a cell</span>
        <span class="c1"># object with the given parameter values and places an instance of that cell inside this cell</span>
        <span class="c1"># with the given transformation.</span>
        <span class="c1"># (Note that the chip origin is at the bottom left corner of the chip)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">insert_cell</span><span class="p">(</span><span class="n">SimpleCross</span><span class="p">,</span> <span class="n">pya</span><span class="o">.</span><span class="n">DTrans</span><span class="p">(</span><span class="n">half_width</span><span class="p">,</span> <span class="n">half_width</span><span class="p">),</span> <span class="n">arm_length</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>

        <span class="c1"># Another option is to first create the cell separately using add_element, and then insert</span>
        <span class="c1"># instances of that cell using insert_cell. This can be useful when placing many instances</span>
        <span class="c1"># with the same parameter values.</span>
        <span class="n">cross_cell</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_element</span><span class="p">(</span><span class="n">SimpleCross</span><span class="p">,</span> <span class="n">arm_length</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">insert_cell</span><span class="p">(</span><span class="n">cross_cell</span><span class="p">,</span> <span class="n">pya</span><span class="o">.</span><span class="n">DTrans</span><span class="p">(</span><span class="n">half_width</span> <span class="o">-</span> <span class="mi">2000</span><span class="p">,</span> <span class="n">half_width</span> <span class="o">-</span> <span class="mi">2000</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">insert_cell</span><span class="p">(</span><span class="n">cross_cell</span><span class="p">,</span> <span class="n">pya</span><span class="o">.</span><span class="n">DTrans</span><span class="p">(</span><span class="n">half_width</span> <span class="o">-</span> <span class="mi">2000</span><span class="p">,</span> <span class="n">half_width</span> <span class="o">+</span> <span class="mi">2000</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">insert_cell</span><span class="p">(</span><span class="n">cross_cell</span><span class="p">,</span> <span class="n">pya</span><span class="o">.</span><span class="n">DTrans</span><span class="p">(</span><span class="n">half_width</span> <span class="o">+</span> <span class="mi">2000</span><span class="p">,</span> <span class="n">half_width</span> <span class="o">+</span> <span class="mi">2000</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">insert_cell</span><span class="p">(</span><span class="n">cross_cell</span><span class="p">,</span> <span class="n">pya</span><span class="o">.</span><span class="n">DTrans</span><span class="p">(</span><span class="n">half_width</span> <span class="o">+</span> <span class="mi">2000</span><span class="p">,</span> <span class="n">half_width</span> <span class="o">-</span> <span class="mi">2000</span><span class="p">))</span>
</pre></div>
</div>
<p>This code can be copied to a new Python-file <code class="docutils literal notranslate"><span class="pre">new_chip1.py</span></code> in the
<code class="docutils literal notranslate"><span class="pre">klayout_package/python/kqcircuits/chips</span></code> folder to make it visible in the
KQCircuits chip library.</p>
<div class="section" id="defining-sampleholder-types">
<h3>Defining sampleholder types<a class="headerlink" href="#defining-sampleholder-types" title="Permalink to this headline">¶</a></h3>
<p>In the previous example we used:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">produce_launchers</span><span class="p">(</span><span class="s2">&quot;SMA8&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>to make the chip have the correct launchers and size for fitting in an
“SMA8”-type sampleholder. The available sampleholder types are  defined in
<a class="reference external" href="https://github.com/iqm-finland/KQCircuits/blob/main/klayout_package/python/kqcircuits/defaults.py">defaults.py</a>
<code class="docutils literal notranslate"><span class="pre">default_sampleholders</span></code>. You can add new sampleholder types there, for
example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;RF16&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;n&quot;</span><span class="p">:</span> <span class="mi">16</span><span class="p">,</span>
    <span class="s2">&quot;launcher_type&quot;</span><span class="p">:</span> <span class="s2">&quot;RF&quot;</span><span class="p">,</span>
    <span class="s2">&quot;launcher_width&quot;</span><span class="p">:</span> <span class="mi">400</span><span class="p">,</span>
    <span class="s2">&quot;launcher_gap&quot;</span><span class="p">:</span> <span class="mi">150</span><span class="p">,</span>
    <span class="s2">&quot;launcher_indent&quot;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span>
    <span class="s2">&quot;pad_pitch&quot;</span><span class="p">:</span> <span class="mi">2000</span><span class="p">,</span>
    <span class="s2">&quot;chip_box&quot;</span><span class="p">:</span> <span class="n">pya</span><span class="o">.</span><span class="n">DBox</span><span class="p">(</span><span class="n">pya</span><span class="o">.</span><span class="n">DPoint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">pya</span><span class="o">.</span><span class="n">DPoint</span><span class="p">(</span><span class="mi">12000</span><span class="p">,</span> <span class="mi">12000</span><span class="p">))</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This can then be used in a chip:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">produce_launchers</span><span class="p">(</span><span class="s2">&quot;RF16&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>A quick way to check all available sampleholder types is to use the
<a class="reference internal" href="../api/kqcircuits.chips.launchers.html#kqcircuits.chips.launchers.Launchers" title="kqcircuits.chips.launchers.Launchers"><code class="xref py py-class docutils literal notranslate"><span class="pre">Launchers</span></code></a> chip and change its <code class="docutils literal notranslate"><span class="pre">sampleholder_type</span></code> parameter.</p>
</div>
</div>
<div class="section" id="refpoints">
<h2>Refpoints<a class="headerlink" href="#refpoints" title="Permalink to this headline">¶</a></h2>
<p>In an Element definition <code class="docutils literal notranslate"><span class="pre">refpoints</span></code> is just a dictionary of points. You can add to it by
assigning a point to a name, <code class="docutils literal notranslate"><span class="pre">self.refpoints['name']</span> <span class="pre">=</span> <span class="pre">pya.DPoint(...)</span></code>.</p>
<p>There are several ways the refpoints are used:</p>
<ul class="simple">
<li><p>The dictionary of a particular Element instance is returned by <code class="docutils literal notranslate"><span class="pre">self.insert_cell()</span></code>. So you can
insert a cell and then use the refpoints as references where to place other elements in relation
to them.</p></li>
<li><p>If you pass an <code class="docutils literal notranslate"><span class="pre">inst_name</span></code> argument to <code class="docutils literal notranslate"><span class="pre">insert_cell()</span></code> the refpoints are also named uniquely
for the instance as <code class="docutils literal notranslate"><span class="pre">{inst_name}_{refpoint_name}</span></code> and added as text instances to the layout.
This way you can later look up the points by name.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">insert_cell</span></code> also has a <code class="docutils literal notranslate"><span class="pre">rec_levels</span></code> argument which determines now many layers down the
hierarchy the refpoints are added.</p></li>
</ul>
<p>As an example of using refpoints, let us extend the NewChip1 code from
previous section. Here we add a waveguide from a launcher to a capacitor
using refpoints:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># In addition to the imports from previous example, import these:</span>
<span class="kn">from</span> <span class="nn">kqcircuits.elements.waveguide_coplanar</span> <span class="kn">import</span> <span class="n">WaveguideCoplanar</span>
<span class="kn">from</span> <span class="nn">kqcircuits.elements.finger_capacitor_square</span> <span class="kn">import</span> <span class="n">FingerCapacitorSquare</span>


<span class="k">class</span> <span class="nc">NewChip1</span><span class="p">(</span><span class="n">Chip</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="c1"># After produce_launchers call, there will be &quot;chip-level&quot; refpoints in self.refpoints.</span>
        <span class="c1"># These refpoints have prefixes corresponding to launcher names, such as &quot;WN&quot; for one</span>
        <span class="c1"># of the SMA8 launchers. Same is true for elements inserted with an inst_name.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">produce_launchers</span><span class="p">(</span><span class="s2">&quot;SMA8&quot;</span><span class="p">)</span>

        <span class="c1"># ... other code here ...</span>

        <span class="c1"># insert_cell can return a dictionary of refpoints for the inserted element</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">cap_refpoints</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">insert_cell</span><span class="p">(</span><span class="n">FingerCapacitorSquare</span><span class="p">,</span> <span class="n">pya</span><span class="o">.</span><span class="n">DTrans</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="mi">5000</span><span class="p">,</span> <span class="mi">3000</span><span class="p">))</span>
        <span class="c1"># Refpoints can be used to position WaveguideCoplanar path points or WaveguideComposite nodes.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">insert_cell</span><span class="p">(</span>
            <span class="n">WaveguideCoplanar</span><span class="p">,</span>
            <span class="n">path</span><span class="o">=</span><span class="n">pya</span><span class="o">.</span><span class="n">DPath</span><span class="p">([</span>
                <span class="c1"># &quot;Chip-level&quot; refpoints with launcher name prefix &quot;WN&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">refpoints</span><span class="p">[</span><span class="s2">&quot;WN_port&quot;</span><span class="p">],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">refpoints</span><span class="p">[</span><span class="s2">&quot;WN_port_corner&quot;</span><span class="p">],</span>
                <span class="c1"># Refpoints of the capacitor element instance (no instance name prefix)</span>
                <span class="n">cap_refpoints</span><span class="p">[</span><span class="s2">&quot;port_b_corner&quot;</span><span class="p">],</span>
                <span class="n">cap_refpoints</span><span class="p">[</span><span class="s2">&quot;port_b&quot;</span><span class="p">],</span>
            <span class="p">],</span> <span class="mi">0</span><span class="p">),</span>
        <span class="p">)</span>
</pre></div>
</div>
<p>How to use the points once they exist? Several styles have evolved:</p>
<ul class="simple">
<li><p>Just use them as a point and perhaps do some geometry calculations to come up with other points
relative to it. This style is mostly useful inside element code, since it is there you really need
to decide on geometry.</p></li>
<li><p>On the Chip or Simulation level you can use <code class="docutils literal notranslate"><span class="pre">align</span></code> and <code class="docutils literal notranslate"><span class="pre">align_to</span></code> arguments of
<code class="docutils literal notranslate"><span class="pre">insert_cell()</span></code>. These can be either a point or a string name referring to a refpoint name, and
will displace (but not rotate!) the element such that the two points overlap. For example,
<code class="docutils literal notranslate"><span class="pre">insert_cell(SomeElement,</span> <span class="pre">align=&quot;refpoint_of_some_element&quot;,</span>
<span class="pre">align_to=self.refpoints[&quot;existing_ref&quot;])</span></code>.</p></li>
</ul>
<p>There is a convention followed almost everywhere: Places where you normally connect coplanar
waveguides have a refpoint named <code class="docutils literal notranslate"><span class="pre">something_port</span></code> and a second refpoint <code class="docutils literal notranslate"><span class="pre">something_port_corner</span></code>
which is one corner-radius (<code class="docutils literal notranslate"><span class="pre">r</span></code>) away and indicates the direction that the connecting waveguide
should go. You can connect a waveguide correctly by routing it from <code class="docutils literal notranslate"><span class="pre">something_port</span></code> to
<code class="docutils literal notranslate"><span class="pre">something_port_corner</span></code>, and then wherever you want to go (can’t do more than 90 degree turns this
way!). This point is also useful in simulations to pass to <code class="docutils literal notranslate"><span class="pre">produce_waveguide_to_port()</span></code>.</p>
<p>The <a class="reference internal" href="../api/kqcircuits.elements.waveguide_composite.html#kqcircuits.elements.waveguide_composite.WaveguideComposite" title="kqcircuits.elements.waveguide_composite.WaveguideComposite"><code class="xref py py-class docutils literal notranslate"><span class="pre">WaveguideComposite</span></code></a> element has some logic where you can insert arbitrary elements
inside waveguides and it uses these points to align and connect them correctly.</p>
<p>Refpoints are not visible by default in KLayout. Enable the <code class="docutils literal notranslate"><span class="pre">texts/refpoints</span></code> layer to see all
refpoints. If there are many overlapping refpoints the texts can be hard to read. In this case, the
<code class="docutils literal notranslate"><span class="pre">texts/top</span> <span class="pre">refpoints</span></code> layer may be used to see only the top-level refpoints. For this choose a new
top cell by right clicking the chip in the cell view of KLayout and selecting “Show As New Top”.
This can be very useful to see “chip-level” refpoints only.</p>
</div>
<div class="section" id="faces">
<h2>Faces<a class="headerlink" href="#faces" title="Permalink to this headline">¶</a></h2>
<p>KQCircuit layers are grouped by faces and functionality. A chip’s “face” intuitively means the
bottom or top sides of it. To identify faces in multi chip configurations we number the chips from
“1”. For technical reasons we permit multiple faces in a particular side. For example “2b1” denotes
the bottom face of the 2nd chip in a typical flip-chip configuration. See more details in
<a class="reference external" href="https://github.com/iqm-finland/KQCircuits/blob/main/klayout_package/python/kqcircuits/layer_config/default_layer_config.py">default_layer_config.py</a>.</p>
<p>Elements support a concept of <strong>faces</strong>, used for 3D-integrated chips to place shapes in layers
belonging to different sides of (possibly) different wafers. For example, an
element may create shapes in face 0 and face 1, and the <code class="docutils literal notranslate"><span class="pre">face_ids</span></code> parameter
of the element determines which actual chip faces <code class="docutils literal notranslate"><span class="pre">0</span></code> and <code class="docutils literal notranslate"><span class="pre">1</span></code> refer to.
By default, KQC elements have <code class="docutils literal notranslate"><span class="pre">face_ids=[&quot;1t1&quot;,&quot;2b1&quot;,&quot;2t1&quot;]</span></code>, so face 0 would be
“1t1” and face 1 would be “2b1”.</p>
<p>To choose which face/layer a shape is placed in, you can use the <code class="docutils literal notranslate"><span class="pre">face_id</span></code>
argument of <code class="docutils literal notranslate"><span class="pre">self.get_layer</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># (the face_id passed to self.get_layer is actually an index to self.face_ids)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">cell</span><span class="o">.</span><span class="n">shapes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_layer</span><span class="p">(</span><span class="s2">&quot;indium_bump&quot;</span><span class="p">,</span> <span class="n">face_id</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pya</span><span class="o">.</span><span class="n">DBox</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
<span class="bp">self</span><span class="o">.</span><span class="n">cell</span><span class="o">.</span><span class="n">shapes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_layer</span><span class="p">(</span><span class="s2">&quot;indium_bump&quot;</span><span class="p">,</span> <span class="n">face_id</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pya</span><span class="o">.</span><span class="n">DBox</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span>
</pre></div>
</div>
<p>Note that by default <code class="docutils literal notranslate"><span class="pre">face_id=0</span></code> will be used in <code class="docutils literal notranslate"><span class="pre">get_layer</span></code>, so it could
be omitted. It is also possible to change the face in which subcells are
placed in:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Placing a single-face element in a different face than the default</span>
<span class="bp">self</span><span class="o">.</span><span class="n">insert_cell</span><span class="p">(</span><span class="n">Launcher</span><span class="p">,</span> <span class="n">face_ids</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">face_ids</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
<span class="c1"># Placing a multi-face element with the parts in different faces swapped</span>
<span class="bp">self</span><span class="o">.</span><span class="n">insert_cell</span><span class="p">(</span><span class="n">FlipChipConnectorRf</span><span class="p">,</span> <span class="n">face_ids</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">face_ids</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">face_ids</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
</pre></div>
</div>
<div class="section" id="layer-configuration-files">
<h3>Layer configuration files<a class="headerlink" href="#layer-configuration-files" title="Permalink to this headline">¶</a></h3>
<p>Layer configuration files are used to define the names of layers and faces, and
many other values related to them. The <code class="docutils literal notranslate"><span class="pre">layer_config_path</span></code> variable in
<a class="reference external" href="https://github.com/iqm-finland/KQCircuits/blob/main/klayout_package/python/kqcircuits/defaults.py">defaults.py</a>
controls which layer configuration file is used, so you can define your own
layer configuration with completely different layer names etc. and use it by
changing <code class="docutils literal notranslate"><span class="pre">layer_config_path</span></code>.</p>
<p>For more information on what to include in these layer configuration files, see
the comments in <a class="reference external" href="https://github.com/iqm-finland/KQCircuits/blob/main/klayout_package/python/kqcircuits/defaults.py">defaults.py</a>
and the layer configuration files in
<a class="reference external" href="https://github.com/iqm-finland/KQCircuits/blob/main/klayout_package/python/kqcircuits/layer_config">layer_config</a>
directory. Currently included are
<a class="reference external" href="https://github.com/iqm-finland/KQCircuits/blob/main/klayout_package/python/kqcircuits/layer_config/default_layer_config.py">default_layer_config.py</a>
(used by default in KQC) and a simpler
<a class="reference external" href="https://github.com/iqm-finland/KQCircuits/blob/main/klayout_package/python/kqcircuits/layer_config/example_layer_config.py">example_layer_config.py</a>
which may be useful as a starting point to define your own layer
configuration file.</p>
</div>
<div class="section" id="adding-a-new-face">
<h3>Adding a new face<a class="headerlink" href="#adding-a-new-face" title="Permalink to this headline">¶</a></h3>
<p>New layers and new faces can be added in
<a class="reference external" href="https://github.com/iqm-finland/KQCircuits/blob/main/klayout_package/python/kqcircuits/defaults.py">defaults.py</a>
by modifying <code class="docutils literal notranslate"><span class="pre">default_layers</span></code> and <code class="docutils literal notranslate"><span class="pre">default_faces</span></code>. As an example, let’s
add a new face <code class="docutils literal notranslate"><span class="pre">x</span></code> with some layers that are in KQCircuits default faces
and one new layer:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">default_layers</span><span class="p">[</span><span class="s2">&quot;x_base_metal_gap_wo_grid&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pya</span><span class="o">.</span><span class="n">LayerInfo</span><span class="p">(</span><span class="mi">130</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="s2">&quot;x_base_metal_gap_wo_grid&quot;</span><span class="p">)</span>
<span class="n">default_layers</span><span class="p">[</span><span class="s2">&quot;x_ground_grid_avoidance&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pya</span><span class="o">.</span><span class="n">LayerInfo</span><span class="p">(</span><span class="mi">133</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="s2">&quot;x_ground_grid_avoidance&quot;</span><span class="p">)</span>
<span class="n">default_layers</span><span class="p">[</span><span class="s2">&quot;x_ports&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pya</span><span class="o">.</span><span class="n">LayerInfo</span><span class="p">(</span><span class="mi">154</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="s2">&quot;x_ports&quot;</span><span class="p">)</span>
<span class="n">default_layers</span><span class="p">[</span><span class="s2">&quot;x_new_layer&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pya</span><span class="o">.</span><span class="n">LayerInfo</span><span class="p">(</span><span class="mi">999</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="s2">&quot;x_new_layer&quot;</span><span class="p">)</span>

<span class="n">default_faces</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;x&quot;</span><span class="p">,</span>
    <span class="s2">&quot;base_metal_gap_wo_grid&quot;</span><span class="p">:</span> <span class="n">default_layers</span><span class="p">[</span><span class="s2">&quot;x_base_metal_gap_wo_grid&quot;</span><span class="p">],</span>
    <span class="s2">&quot;ground_grid_avoidance&quot;</span><span class="p">:</span> <span class="n">default_layers</span><span class="p">[</span><span class="s2">&quot;x_ground_grid_avoidance&quot;</span><span class="p">],</span>
    <span class="s2">&quot;ports&quot;</span><span class="p">:</span> <span class="n">default_layers</span><span class="p">[</span><span class="s2">&quot;x_ports&quot;</span><span class="p">],</span>
    <span class="s2">&quot;new_layer&quot;</span><span class="p">:</span> <span class="n">default_layers</span><span class="p">[</span><span class="s2">&quot;x_new_layer&quot;</span><span class="p">],</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The layers are identified by <code class="docutils literal notranslate"><span class="pre">layer</span> <span class="pre">number</span></code>, <code class="docutils literal notranslate"><span class="pre">data</span> <span class="pre">type</span></code> and <code class="docutils literal notranslate"><span class="pre">name</span></code>,
e.g. <code class="docutils literal notranslate"><span class="pre">900</span></code>, <code class="docutils literal notranslate"><span class="pre">1</span></code> and <code class="docutils literal notranslate"><span class="pre">x_base_metal_gap_wo_grid</span></code></p>
<p>These lines should be added after the last line where <code class="docutils literal notranslate"><span class="pre">default_layers</span></code> or
<code class="docutils literal notranslate"><span class="pre">default_faces</span></code> are modified. It is best to do these changes in the layer
configuration file (see previous section), although it can also be done in
<cite>defaults.py</cite> directly. Launching KLayout after these changes, you
should see the new layers in the layers list. If you add for example
<a class="reference internal" href="../api/kqcircuits.elements.launcher.html#kqcircuits.elements.launcher.Launcher" title="kqcircuits.elements.launcher.Launcher"><code class="xref py py-class docutils literal notranslate"><span class="pre">Launcher</span></code></a> element to the layout and modify its <code class="docutils literal notranslate"><span class="pre">face_ids</span></code>
parameter to have the value <code class="docutils literal notranslate"><span class="pre">x</span></code>, it will then use the layers from the newly
added face <code class="docutils literal notranslate"><span class="pre">x</span></code>.</p>
<p>To change the color of the layers and their organization in the layers list,
the layer properties file (determined by <code class="docutils literal notranslate"><span class="pre">default_layer_props</span></code> in the layer
configuration file) must be modified or another layer properties file must be
set as default in KLayout Setup menu. The layer properties file can be edited
directly or by modifying the layers list in GUI and saving them using KLayout
<code class="docutils literal notranslate"><span class="pre">File</span> <span class="pre">-&gt;</span> <span class="pre">Save</span> <span class="pre">Layer</span> <span class="pre">Properties</span></code>.</p>
</div>
</div>
<div class="section" id="kqcircuit-s-layers">
<h2>KQCircuit’s Layers<a class="headerlink" href="#kqcircuit-s-layers" title="Permalink to this headline">¶</a></h2>
<p>KLayout’s right panel shows a layer tree. Layers containing meaningful device geometry are grouped
by faces: <code class="docutils literal notranslate"><span class="pre">1t1-face</span></code>, <code class="docutils literal notranslate"><span class="pre">2b1-face</span></code> and <code class="docutils literal notranslate"><span class="pre">2t1-face</span></code>. By default layer numbers 0-127 are used for
the bottom face of the chips and 128-255 are used for the top face, and the data type indicates the
chip number (data type 0 is used for layers not belonging to chip faces). Other texts, annotations
and miscellaneous things not strictly belonging to a particular face are under the <code class="docutils literal notranslate"><span class="pre">texts</span></code> layer
group. Other layers used only for simulations are under the aptly named <code class="docutils literal notranslate"><span class="pre">simulations</span></code> layer group.</p>
<p>Most layers have self-describing names like <code class="docutils literal notranslate"><span class="pre">refpoints</span></code> or <code class="docutils literal notranslate"><span class="pre">instance</span> <span class="pre">names</span></code> but others need a
bit of explanation:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">base</span> <span class="pre">metal</span> <span class="pre">gap</span></code> – Important layer with the final geometry of chips <em>in masks</em>. It has the
shapes of gaps (areas without metal) in the base metal layer that is laid out on a silicon
substrate.  Note that this layer is populated during mask export and therefore usually empty. It is hidden by default.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">base</span> <span class="pre">metal</span> <span class="pre">gap</span> <span class="pre">wo</span> <span class="pre">grid</span></code> – Like above, it has the gaps around shapes “etched” into metal but
<em>without</em> the ground grid that is slow to produce.  This is the most used layer in elements.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">groud</span> <span class="pre">grid</span></code> – This layer is auto generated if the “Make ground plane grid” PCell parameter is
enabled in a chip. It fills in the chip area <em>outside</em> of shapes in the <code class="docutils literal notranslate"><span class="pre">ground</span> <span class="pre">grid</span> <span class="pre">avoidance</span></code>
layer with a metal grid.  Technically, this layer contains the square shaped gaps in the grid, not
the metal grid itself. Hidden by default.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">base</span> <span class="pre">metal</span> <span class="pre">addition</span></code> – Puts back metal to places where it is already removed. This is a
technical layer helping us to construct the final shapes in a more elegant way, particularly here:
<code class="docutils literal notranslate"><span class="pre">base_metal_gap</span> <span class="pre">=</span> <span class="pre">base_metal_gap_wo_grid</span> <span class="pre">+</span> <span class="pre">ground_grid</span> <span class="pre">-</span> <span class="pre">base_metal_addition</span></code>. It is also used
in <code class="docutils literal notranslate"><span class="pre">base</span> <span class="pre">metal</span> <span class="pre">gap</span> <span class="pre">for</span> <span class="pre">EBL</span></code>, i.e. Electron Beam Litography.</p></li>
</ul>
<p>Find more details in <a class="reference external" href="../api/kqcircuits.defaults.html">defaults.py</a>.</p>
</div>
<div class="section" id="opening-element-or-chip-from-an-ide">
<h2>Opening <a class="reference internal" href="../api/kqcircuits.elements.element.html#kqcircuits.elements.element.Element" title="kqcircuits.elements.element.Element"><code class="xref py py-class docutils literal notranslate"><span class="pre">Element</span></code></a> or <a class="reference internal" href="../api/kqcircuits.chips.chip.html#kqcircuits.chips.chip.Chip" title="kqcircuits.chips.chip.Chip"><code class="xref py py-class docutils literal notranslate"><span class="pre">Chip</span></code></a> from an IDE<a class="headerlink" href="#opening-element-or-chip-from-an-ide" title="Permalink to this headline">¶</a></h2>
<p>You can use <a class="reference external" href="https://github.com/iqm-finland/KQCircuits/blob/main/util/create_element_from_path.py">util/create_element_from_path.py</a> to open a
<a class="reference internal" href="../api/kqcircuits.elements.element.html#kqcircuits.elements.element.Element" title="kqcircuits.elements.element.Element"><code class="xref py py-class docutils literal notranslate"><span class="pre">Element</span></code></a> or <a class="reference internal" href="../api/kqcircuits.chips.chip.html#kqcircuits.chips.chip.Chip" title="kqcircuits.chips.chip.Chip"><code class="xref py py-class docutils literal notranslate"><span class="pre">Chip</span></code></a> in KLayout from your IDE (or just straight from the
command-line).  The script is used as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">klayout</span> <span class="o">-</span><span class="n">e</span> <span class="o">-</span><span class="n">rx</span> <span class="o">-</span><span class="n">rm</span> <span class="n">util</span><span class="o">/</span><span class="n">create_element_from_path</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">rd</span> <span class="n">element_path</span><span class="o">=</span><span class="n">kqcircuits</span><span class="o">/</span><span class="n">chips</span><span class="o">/</span><span class="n">demo</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>And can be easily incorporated as a macro to your IDE.  Check the comments in the function on how to
use it in PyCharm or Visual Studio Code. The <code class="docutils literal notranslate"><span class="pre">element_path</span></code> argument can strip a leading
<cite>*Circuits/klayout_package/python/</cite> or <cite>klayout_package/python/</cite>, use what is easiest to implement
for your workflow.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="macro_workflow.html" class="btn btn-neutral float-right" title="Macro development" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="gui_workflow.html" class="btn btn-neutral float-left" title="Point-and-click workflow tutorial" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021-2023, IQM.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>